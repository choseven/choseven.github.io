(()=>{"use strict";const e=(e,t,i)=>{console.debug(`${i} TSS: hosted page injected`),console.debug(`${i} MBTSS: Nonce: `,e);let o=!1,s=!1,n={},a={},r={},c={};function l({object:t,f:i,subtype:n,detectFunc:a,proxy:r=d,isBrowserlocker:c=!0}){let l=t[i];t[i]=function(){if(o&&!s&&c)throw new Error("Breaking Browser Locker Behavior detected");let t=[].slice.call(arguments);if(!s&&a(t)&&(o=!0),o&&!s&&function(t,i){window.top.postMessage(JSON.parse(JSON.stringify({type:"scam",subtype:t,parameters:i,nonce:e})),"*")}(n,t),o&&!s&&c)throw new Error("Breaking Browser Locker Behavior detected");return r(l,this,t)}}function d(e,t,i){return e.apply(t,i)}function u(e,i,o){return t(e,i,o)}function S(e){return console.debug("TSS: Counted history being replaced"),p()}function p(e){return console.debug("TSS: Caught history"),u(n,1e3,500)}l({object:window,f:"print",subtype:"printLoop",detectFunc:function(e){return console.debug("TSS: caught print"),u(a,1e4,3)}}),l({object:window.history,f:"pushState",subtype:"historyLoop",detectFunc:function(e){return console.debug("TSS: Counted history being pushed"),p()}}),window.setTimeout(function(){l({object:window.history,f:"replaceState",subtype:"historyLoop",detectFunc:S})},2e3),l({object:URL,f:"createObjectURL",subtype:"createURLLoop",detectFunc:function(e){return console.debug("TSS: Caught create URL"),u(r,1e3,500)}}),window.chrome&&window.chrome.webstore&&l({object:chrome.webstore,f:"install",subtype:"extensionInstall",detectFunc:function(e){return console.debug("TSS: Caught webstore install"),!0},isBrowserlocker:!1}),window.Notification&&l({object:window.Notification,f:"requestPermission",subtype:"notificationLoop",detectFunc:function(e){return console.debug("TSS: Caught notification permission request"),u(c,5e3,2)},isBrowserlocker:!1}),window.addEventListener("message",function(t){t.source===window&&t.data.nonce===e&&"exclude"===t.data.type&&(s=!0)},!1)};Object.freeze({LicenseStateUnknown:0,LicenseStateFree:1,LicenseStateTrial:2,LicenseStateTrialExpired:3,LicenseStateLicensed:4,LicenseStateLicenseExpired:5,LicenseStateLicenseGrace:6}),Object.freeze([2,4,6]),Object.freeze({MALWARE:Object.freeze({type:"malware",FULL_URL_MALWARE:"full-url-malware",SUSPICIOUS_PAGE:"suspiciousPage",SUSPICIOUS_TLD:"suspiciousTLD",RISKY_PATTERN:"riskyPattern",SUSPICIOUS_CONTENT:"suspiciousContent",MALWARE_PATTERN:"malware-pattern",ALERT_LOOP:"alertLoop",AUTH_REQUIRED_LOOP:"authRequiredLoop",CREATE_URL_LOOP:"createURLLoop",EXTENSION_INSTALL:"extensionInstall",FULL_SCREEN_LOOP:"fullScreenLoop",HISTORY_LOOP:"historyLoop",NOTIFICATION_LOOP:"notificationLoop",PRINT_LOOP:"printLoop",ADWARE:"adware",REPUTATION:"reputation",TROJAN:"trojan",MALVERTISING:"malvertising",WORM:"worm",RANSOMWARE:"ransomware",ROOTKIT:"rootkit",BACKDOOR:"backdoor",SPYWARE:"spyware",ALLOWED_EXCLUSION_VALUE:4}),SCAM:Object.freeze({type:"scam",TSS:"tss",SCAM_HEURISTIC:"scam_heuristic",ALLOWED_EXCLUSION_VALUE:6}),PHISHING:Object.freeze({type:"phishing",PHISHING_SUSPICIOUS_POST:"phishing_suspicious_post",PHISHING_BANKING:"phishing_banking",PHISHING_LOGIN:"phishing_login",PHISHING_LOGIN_VIA_TUNNEL:"phishing_login_via_tunnel",TELEMETRY_PHISHING_TUNNEL:"telemetryPhishingTunnel"}),AD:Object.freeze({type:"ad",ADSERVER:"adserver",ALLOWED_EXCLUSION_VALUE:2}),ADS:Object.freeze({type:"ads",ADSERVER:"adserver",ALLOWED_EXCLUSION_VALUE:2})}),Object.freeze({CHROME:"Chrome",FIREFOX:"Firefox",OPERA:"Opera",EDGE:"Edge",SAFARI:"Safari"}),Object.freeze({origins:["<all_urls>"],permissions:[],optional_permissions:[]}),new RegExp(/^(.*?)(##|#\?#)(.+)$/),Object.freeze({Chrome:Object.freeze({origins:[],permissions:["alarms","downloads","storage","tabs","declarativeNetRequest","declarativeNetRequestFeedback","unlimitedStorage","webRequest","contextMenus","nativeMessaging","offscreen","activeTab","clipboardRead"]}),Firefox:Object.freeze({origins:[],permissions:["alarms","downloads","storage","tabs","declarativeNetRequest","declarativeNetRequestFeedback","unlimitedStorage","webRequest","webRequestBlocking","contextMenus","nativeMessaging","activeTab","clipboardRead"]}),Edge:Object.freeze({origins:[],permissions:["alarms","downloads","nativeMessaging","storage","tabs","webRequest","declarativeNetRequest","declarativeNetRequestFeedback","unlimitedStorage","contextMenus","offscreen","clipboardRead"]}),Safari:Object.freeze({origins:[],permissions:[]})}),Object.freeze({clipboardRead:{title:"clipboardReadPermTitle",description:"clipboardReadPermDesc"},clipboardWrite:{title:"clipboardWritePermTitle",description:"clipboardWritePermDesc"},alarms:{title:"alarms",description:"alarms"},downloads:{title:"downloads",description:"downloads"},storage:{title:"storage",description:"storage"},tabs:{title:"tabs",description:"tabs"},declarativeNetRequest:{title:"declarativeNetRequest",description:"declarativeNetRequest"},declarativeNetRequestFeedback:{title:"declarativeNetRequestFeedback",description:"declarativeNetRequestFeedback"},unlimitedStorage:{title:"unlimitedStorage",description:"unlimitedStorage"},webRequest:{title:"webRequest",description:"webRequest"},contextMenus:{title:"contextMenus",description:"contextMenus"},nativeMessaging:{title:"nativeMessaging",description:"nativeMessaging"},offscreen:{title:"offscreen",description:"offscreen"},activeTab:{title:"activeTab",description:"activeTab"}}),window.addEventListener.bind(window)("message",e=>{e.source===window&&e.data&&"MSG_CHECK_DOMAIN_ALLOW_LIST_RESPONSE"===e.data.type&&window.__tssResolve&&(window.__tssResolve({isAllowListed:e.data.isAllowListed,isProtectionEnabled:e.data.isProtectionEnabled,isScamsProtectionEnabled:e.data.isScamsProtectionEnabled}),window.__tssResolve=null)}),new Promise(e=>{window.__tssResolve=e,""!==window.location.hostname&&window.postMessage({type:"MSG_CHECK_DOMAIN_ALLOW_LIST",domainUrl:window.location.hostname,exclusionType:"EXCLUSION_SCAMS"},window.location.origin)}).then(t=>{const{isAllowListed:i,isProtectionEnabled:o,isScamsProtectionEnabled:s}=t;console.log("TSS: Received response from checkDomainAndRun:",{isAllowListed:i,isProtectionEnabled:o,isScamsProtectionEnabled:s}),!i&&o&&s?e("nonce",(e,t,i)=>{console.debug(`TSS: Checking if repeated ${i} times for interval ${t} against data: `,e);const o=Date.now();if(e.lastTime)if(o-e.lastTime<t){if(e.lastCount++,e.lastCount>=i)return!0}else e.lastTime=o,e.lastCount=1;else{if(1===i)return e.lastTime=o,e.lastCount=1,!0;e.lastTime=o,e.lastCount=1}return!1},"injection-tss"):i?console.log("TSS: Domain is in allow list, skipping TSS setup."):o?s||console.log("TSS: Scams protection is disabled, skipping TSS setup."):console.log("TSS: Protection is disabled, skipping TSS setup.")})})();
//# sourceMappingURL=injection-tss-mv3.js.map