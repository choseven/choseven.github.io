<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Letter Reaction Challenge</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    body {
      font-family: 'Press Start 2P', cursive;
      background: #111;
      color: white;
      margin: 0;
      overflow: hidden;
      position: relative;
    }

    .container {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .letter {
      font-size: 32px;
      font-weight: bold;
      color: yellow;
      position: absolute;
    }

    .circle, .circle-inner {
      position: absolute;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
    }

    .circle {
      width: 100px;
      height: 100px;
      border: 6px solid rgba(255, 255, 255, 0.95);
      transition: width linear, height linear;
    }

    .circle-inner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(0, 200, 255, 0.95);
    }

    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 36px;
    }

    #score-value {
      display: inline-block;
      transform-origin: left center;
    }

    .flash {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 9999;
      animation: flash-effect 0.2s ease-out;
    }

    .perfect {
      position: absolute;
      font-size: 16px;
      color: #0ff;
      text-shadow: 0 0 10px #0ff;
      pointer-events: none;
      animation: fadeOut 0.8s ease-out forwards;
    }

    @keyframes flash-effect {
      0% { opacity: 0.8; }
      100% { opacity: 0; }
    }

    @keyframes fadeOut {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-20px); }
    }
  </style>
</head>
<body>

  <div id="score">Score: <span id="score-value">0</span></div>
  <div id="flash" class="flash"></div>

  <script>
    let score = 0;
    let activeLetters = [];
    let spawnInterval = 1500;
    let shrinkSpeedModifier = 1.0;

    function spawnLetter() {
      const char = String.fromCharCode(65 + Math.floor(Math.random() * 26));
      const x = Math.random() * window.innerWidth * 0.85;
      const y = Math.random() * window.innerHeight * 0.85;
      const duration = (Math.random() * 2000 + 1000) * shrinkSpeedModifier;

      const container = document.createElement("div");
      container.className = "container";
      container.style.left = `${x}px`;
      container.style.top = `${y}px`;

      const letterDiv = document.createElement("div");
      letterDiv.className = "letter";
      letterDiv.innerText = char;

      const outerCircle = document.createElement("div");
      outerCircle.className = "circle";

      const innerCircle = document.createElement("div");
      innerCircle.className = "circle-inner";

      container.appendChild(outerCircle);
      container.appendChild(innerCircle);
      container.appendChild(letterDiv);
      document.body.appendChild(container);

      activeLetters.push({ char, container, outerCircle });

      setTimeout(() => {
        outerCircle.style.transition = `width ${duration}ms linear, height ${duration}ms linear`;
        outerCircle.style.width = "0px";
        outerCircle.style.height = "0px";
      }, 50);

      setTimeout(() => {
        container.remove();
        activeLetters = activeLetters.filter(l => l.char !== char);
      }, duration);
    }

    function triggerFlash() {
      const flash = document.getElementById('flash');
      flash.style.animation = 'none';
      void flash.offsetWidth;
      flash.style.animation = 'flash-effect 0.2s ease-out';
    }

    function showPerfect(x, y) {
      const perfect = document.createElement('div');
      perfect.className = 'perfect';
      perfect.innerText = 'PERFECT!';
      perfect.style.left = `${x}px`;
      perfect.style.top = `${y}px`;
      document.body.appendChild(perfect);
      setTimeout(() => perfect.remove(), 800);
    }

    function checkInput(event) {
      const typedChar = event.key.toUpperCase();
      const index = activeLetters.findIndex(l => l.char === typedChar);

      if (index !== -1) {
        const { outerCircle, container } = activeLetters[index];
        const outerSize = parseFloat(getComputedStyle(outerCircle).width);
        const isPerfect = outerSize <= 58 && outerSize >= 42;

        if (isPerfect) {
          score += 10;
          triggerFlash();
          const rect = container.getBoundingClientRect();
          showPerfect(rect.left, rect.top);
        } else {
          score += 1;
        }

        document.getElementById("score-value").innerText = score;
        container.remove();
        activeLetters.splice(index, 1);
      }
    }

    function updateRotation() {
      const scoreVal = document.getElementById("score-value");
      let angle = 0;

      function rotate() {
        const speed = Math.min(0.1 + score * 0.02, 6); // scale faster
        angle += speed;
        scoreVal.style.transform = `rotate(${angle}deg)`;
        requestAnimationFrame(rotate);
      }

      rotate();
    }

    function spawnLoop() {
      spawnLetter();
      setTimeout(spawnLoop, spawnInterval);
    }

    function scaleDifficulty() {
      setInterval(() => {
        if (spawnInterval > 400) spawnInterval -= 100;
        if (shrinkSpeedModifier > 0.6) shrinkSpeedModifier *= 0.95;
      }, 15000);
    }

    document.addEventListener("keydown", checkInput);
    updateRotation();
    spawnLoop();
    scaleDifficulty();
  </script>
</body>
</html>
