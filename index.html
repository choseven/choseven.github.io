<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Letter Reaction Challenge</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #111;
      color: white;
      margin: 0;
      overflow: hidden;
      position: relative;
    }

    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 36px;
    }

    #score-value {
      display: inline-block;
      transition: filter 0.2s linear;
    }

    #lives {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 36px;
      color: red;
    }

    .container {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .letter {
      font-size: 32px;
      font-weight: bold;
      color: yellow;
      position: absolute;
    }

    .circle {
      position: absolute;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 6px solid rgba(255, 255, 255, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: width linear, height linear;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
    }

    .inner-circle {
      position: absolute;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: 4px solid rgba(255, 255, 255, 0.5);
    }

    .perfect-text {
      position: absolute;
      color: lime;
      font-size: 28px;
      font-weight: bold;
      pointer-events: none;
      animation: pop 1s ease-out forwards;
    }

    @keyframes pop {
      0% { opacity: 1; transform: scale(1); }
      100% { opacity: 0; transform: scale(2); }
    }

    .flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0.6;
      animation: flashbang 0.3s ease-out forwards;
      z-index: 9999;
    }

    @keyframes flashbang {
      from { opacity: 0.6; }
      to { opacity: 0; }
    }

    #game-over {
      position: fixed;
      top: 40%;
      width: 100%;
      text-align: center;
      font-size: 64px;
      font-weight: bold;
      color: red;
      display: none;
      z-index: 10000;
    }

    #game-over small {
      display: block;
      font-size: 24px;
      margin-top: 20px;
      color: white;
    }
  </style>
</head>
<body>

  <div id="score">Score: <span id="score-value">0</span></div>
  <div id="lives">5</div>
  <div id="game-over">GAME OVER<small>Refresh Page</small></div>

  <audio id="perfect-sound" src="correct.mp3" preload="auto"></audio>

  <script>
    let score = 0;
    let lives = 5;
    let gameOver = false;
    let activeLetters = [];
    let difficulty = 1500;

    function spawnLetter() {
      const char = String.fromCharCode(65 + Math.floor(Math.random() * 26));
      const x = Math.random() * window.innerWidth * 0.85;
      const y = Math.random() * window.innerHeight * 0.85;
      const duration = Math.random() * 2000 + 1000;

      const container = document.createElement("div");
      container.className = "container";
      container.style.left = `${x}px`;
      container.style.top = `${y}px`;

      const letterDiv = document.createElement("div");
      letterDiv.className = "letter";
      letterDiv.innerText = char;

      const circleDiv = document.createElement("div");
      circleDiv.className = "circle";

      const innerCircle = document.createElement("div");
      innerCircle.className = "inner-circle";

      circleDiv.appendChild(innerCircle);
      container.appendChild(circleDiv);
      container.appendChild(letterDiv);
      document.body.appendChild(container);

      const start = Date.now();
      activeLetters.push({ char, container, circleDiv, innerCircle, start, duration });

      setTimeout(() => {
        circleDiv.style.transition = `width ${duration}ms linear, height ${duration}ms linear`;
        circleDiv.style.width = "0px";
        circleDiv.style.height = "0px";
      }, 50);

      setTimeout(() => {
        if (!gameOver && document.body.contains(container)) {
          container.remove();
          activeLetters = activeLetters.filter(l => l.char !== char);
          loseLife();
        }
      }, duration + 50);
    }

    function showPerfect(x, y) {
      const text = document.createElement("div");
      text.className = "perfect-text";
      text.innerText = "PERFECT!";
      text.style.left = `${x}px`;
      text.style.top = `${y}px`;
      document.body.appendChild(text);
      setTimeout(() => text.remove(), 1000);
    }

    function triggerFlash() {
      const flash = document.createElement("div");
      flash.className = "flash";
      document.body.appendChild(flash);
      setTimeout(() => flash.remove(), 300);
    }

    function updateScore() {
      const scoreVal = document.getElementById("score-value");
      scoreVal.innerText = score;
    }

    function updateRainbowEffect() {
      const scoreVal = document.getElementById("score-value");
      let hue = 0;

      function animate() {
        if (gameOver) return;
        hue = (hue + Math.min(1 + score * 0.2, 20)) % 360;
        scoreVal.style.filter = `hue-rotate(${hue}deg)`;
        requestAnimationFrame(animate);
      }

      animate();
    }

    function loseLife() {
      lives--;
      document.getElementById("lives").innerText = lives;
      if (lives <= 0) {
        gameOver = true;
        document.getElementById("game-over").style.display = "block";
      }
    }

    function checkInput(event) {
      if (gameOver) return;

      const typedChar = event.key.toUpperCase();
      const index = activeLetters.findIndex(l => l.char === typedChar);
      if (index !== -1) {
        const { container, circleDiv, innerCircle, start, duration } = activeLetters[index];

        const elapsed = Date.now() - start;
        const progress = elapsed / duration;
        const outerSize = 100 * (1 - progress);
        const innerSize = 50;
        const diff = Math.abs(outerSize - innerSize);

        let isPerfect = diff < 25;

        if (isPerfect) {
          score += 10;
          triggerFlash();
          showPerfect(container.offsetLeft, container.offsetTop);
          document.getElementById("perfect-sound").currentTime = 0;
          document.getElementById("perfect-sound").play();
        } else {
          score += 1;
        }

        updateScore();
        container.remove();
        activeLetters.splice(index, 1);
      }
    }

    document.addEventListener("keydown", checkInput);

    function spawnLoop() {
      if (gameOver) return;
      spawnLetter();
      setTimeout(spawnLoop, difficulty);
    }

    function scaleDifficulty() {
      setInterval(() => {
        if (difficulty > 500) difficulty -= 25;
      }, 5000);
    }

    updateRainbowEffect();
    spawnLoop();
    scaleDifficulty();
  </script>
</body>
</html>
